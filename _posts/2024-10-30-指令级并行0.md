---
title: 高性能计算-第三章-指令级并行-序
author: chhokmah0
date: 2024-10-30 21:30:00 +0800
categories: [笔记，高性能计算]
tags: [HPC]     # TAG names should always be lowercase
---
# 指令级并行

当一个程序员听到并行时，他们一般都会想到多核并行。不过本章主要关注点在于单核上的并行。

## 指令流水线

为了运行任何一条指令，处理器都需要做一系列流程，包含：

- 从内存中**取码**；
- 把取出的二进制码**解码**为多个指令；
- **执行**这些指令，其中包含一些可能的内存操作；
- 将结果**写回**寄存器。

整个流程很长，即使是简单的将两个寄存器中的值相加也需要 15-20 个 CPU 周期。为了隐藏这些延迟，现代 CPU 都采用流水线技术。

![流水线](/assets/Instruction_Level_Parallelism/pipeline.png)
_流水线技术_

流水线技术并没有减少实际的延迟。你仍需要支付 15 到 20 个周期来获得结果。但是对于一个长指令序列而言，其中的某一个指令看上去就只有取码的消耗。

基于这一点，硬件制造商更喜欢用每条指令的周期数（cycles per instruction, CPI）作为 CPU 的主要性能指标。

对于一个完全流水线的 CPU，CPI 应该接近于 1。CPI 甚至可以低于 1！只要我们增加流水线的“宽度”，以便同时处理多条指令。由于缓存和大部分 ALU 是共享的，这种方法比新加一个核心更有效益。这种架构被称为“**超标量架构**”，能在每个周期内执行多条指令，大部分现代 CPU 都属于这一类别。

只有指令流中的指令的操作逻辑完全独立时，才能有效使用超标量架构。然而，指令并不总是按照最理想的顺序到达，因此，现代 CPU 在可能的情况下会**乱序执行**，以提高整体的利用率。

## 类比现实

想想我们的教育系统：

- 知识点是向着一群学生一起教授的；
- 一批新生会被分成不同的小组，由不同的老师带领，作业和课程材料在小组之间共享；
- 每年新生都会被教授相同的课程，以确保教师们始终教学。

类比成现代 CPU：

- CPU 使用 SIMD（单指令多数据） 在不同的数据点（通常是 16、32、64 bytes）上执行相同的操作；
- 由多个执行单元，可以同时处理这些指令，并共享 CPU 的其它设施（通常是 2 到 4 个执行单元）；
- 指令以流水线的形式处理。
